<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>把Raspberry Pi打造成 Web Server - ZJUN NOTE</title>
  <meta name="author" content="zJun">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zjun.github.io/blog/2013/09/17/setup_raspberrypi_as_webserver">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="ZJUN NOTE" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">ZJUN NOTE</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">文章</a>
                </li>
                <li >
                    <a href="/blog/archives">归档</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:zjun.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div id="content" class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-17T21:06:19+08:00" pubdate data-updated="true">Sep 17<span>th</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://zjun.github.io">Comments</a>
        
      </p>
    
    
    <h1 class="entry-title">
        把Raspberry Pi打造成 Web Server
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><h2>Setup Raspberry Pi</h2>

<h3>安装</h3>

<p>理论上 OS 可以是任何支持 ARM v6 的 Linux 发行版，推荐使用官方的 wheezy 系统，因为这是针对树莓派定制并优化了的 Debian。<br/>
下载地址：<a href="http://www.raspberrypi.org/downloads" title="http://www.raspberrypi.org/downloads">http://www.raspberrypi.org/downloads</a><br/>
解压之后得到一个 .img 的镜像文件，比如 2013-07-26-wheezy-raspbian.img.</p>

<p>在Windows下使用工具：<a href="http://sourceforge.net/projects/win32diskimager/">win32diskimager</a> 把镜像文件写入 SD 卡。</p>

<p>将刻好的 SD 卡插入树莓派的 SD 卡插槽，接上键盘和显示器。然后开机，也就是插上电源，树莓派没有电源开关，插电即开机。拔出电源就是关机，不过最安全的方式是使用 <code>sudo shutdown -h now</code> 或 <code>sudo halt</code> 命令正确地关闭系统，然后再拔电源。 重启使用 <code>sudo reboot</code> 命令。</p>

<!--more-->


<p></p>

<h3>设置</h3>

<p>第一次开机正常启动后，看到的是 Raspi-config 界面， 你可以使用键盘做一些基本的系统设置:</p>

<ul>
<li>先简单地设置一下地区、时区、键盘。注意默认的键盘布局（layout）设置是 English(UK) （因为是英国人发明的），在 Others 中把它改为 English(US)，否则 # 号的位置不对。</li>
<li>接着还可以修改默认用户 pi 的密码，官方系统的默认账号是 pi / raspberry 。</li>
<li>在 ssh 设置中启用 ssh 服务（默认已启用），这样以后就可以 ssh 远程控制了。</li>
<li>在 boot_behaviour 设置中，设置开机是否自动进入桌面环境（默认进入），选择否则只进入命令行模式。建议关闭桌面，需要的时候使用 <code>startx</code> 命令就可以进入。系统提供的桌面是 LXDE ，有一些基本功能。</li>
<li>expand_rootfs 设置是让你的系统扩展到全部 SD 卡空间，默认没有使用全部 SD 卡空间，所以请执行这个选项。</li>
<li>最后，执行 Finish 完成设置，重启系统。</li>
</ul>


<p>重启之后就不会再出现这个设置界面了，但你随时可以使用 <code>sudo raspi-config</code> 命令再次使用这个设置工具。</p>

<p>装好 OS 后，建议先升级一下系统，最新的更新可能会提高系统的性能：</p>

<div>
  <pre><code class='console'>sudo apt-get update      
sudo apt-get upgrade</code></pre>
</div>


<p>一些在设置系统时常用到的命令：</p>

<ul>
<li><p>关机: <div>
<pre><code class='console'>sudo shutdown -h now</code></pre>
</div>
或 <div>
<pre><code class='console'>sudo halt</code></pre>
</div></p></li>
<li><p>重启: <div>
<pre><code class='console'>sudo reboot</code></pre>
</div></p></li>
<li><p>查看IP地址： <div>
<pre><code class='console'>ifconfig</code></pre>
</div></p></li>
<li><p>Set Up SSH:</p></li>
</ul>


<div>
  <pre><code class='console'>sudo mv /boot/boot_enable_ssh.rc /boot/boot.rc   
sudo shutdown -r now</code></pre>
</div>


<ul>
<li>Install FTP</li>
</ul>


<div>
  <pre><code class='console'>sudo chown -R pi /var/www  -- Take ownership of the web root  
sudo apt-get install vsftpd -- install vsftpd  
sudo service vsftpd restart -- restart vsftpd</code></pre>
</div>


<p>到这里，<strong>就装好了一台 RPi</strong></p>

<h2>Setup Tomcat</h2>

<h3>安装</h3>

<ul>
<li>install tomcat server</li>
</ul>


<div>
  <pre><code class='console'>sudo apt-get install tomcat7</code></pre>
</div>


<h3>设置</h3>

<ul>
<li>link conf and webapps folders</li>
</ul>


<div>
  <pre><code class='console'>cd /usr/share/tomcat7  
sudo rm -r webapps  
sudo ln -s /var/lib/tomcat7/conf conf  
sudo ln -s /var/lib/tomcat7/webapps webapps</code></pre>
</div>


<ul>
<li>give full access to webapps folder</li>
</ul>


<div>
  <pre><code class='console'>sudo chmod 777 /usr/share/tomcat7/webapps</code></pre>
</div>


<ul>
<li>copy war file to server webapps folder (from local pc)</li>
</ul>


<div>
  <pre><code class='console'>scp &lt;path&gt;/&lt;file&gt;.war &lt;username&gt;@&lt;ip&gt;:/usr/share/tomcat7/webapps/&lt;file&gt;.war</code></pre>
</div>


<ul>
<li>restart tomcat server</li>
</ul>


<div>
  <pre><code class='console'>sudo service tomcat7 restart</code></pre>
</div>


<h3>管理</h3>

<ul>
<li>tomcat server commands</li>
</ul>


<div>
  <pre><code class='console'>sudo service tomcat7 [&lt;start&gt; &lt;stop&gt; &lt;restart&gt;]</code></pre>
</div>


<ul>
<li>Where to find the web app log files:</li>
</ul>


<div>
  <pre><code class='console'>/var/log/tomcat</code></pre>
</div>


<h2>Setup MySQL</h2>

<h3>安装</h3>

<ul>
<li>Install MySQL server</li>
</ul>


<div>
  <pre><code class='console'>sudo apt-get install mysql-server mysql-client php5-mysql</code></pre>
</div>


<h3>管理</h3>

<ul>
<li>Manage MySQL service</li>
</ul>


<div>
  <pre><code class='console'>sudo service mysql start/stop/restart</code></pre>
</div>


<h3>设置</h3>

<h4>远程访问</h4>

<p>By default remote access to the MySQL database server is disabled for security reasons.To allow remotely access to the database server from the web server or home, follow below quick steps.</p>

<p><strong>1.Edit my.cnf File</strong>  <br/>
&ndash; If you are using Debian Linux file is located at <strong>/etc/mysql/my.cnf</strong> location <br/>
&ndash; If you are using Red Hat Linux/Fedora/Centos Linux file is located at <strong>/etc/my.cnf</strong> location <br/>
&ndash; If you are using FreeBSD you need to create a file <strong>/var/db/mysql/my.cnf</strong>
Edit <strong>/etc/my.cnf</strong>, run:</p>

<div>
  <pre><code class='console'>vi /etc/my.cnf</code></pre>
</div>


<p>Once file opened, locate line that read as follows</p>

<p>[mysqld]<br/>
Make sure line skip-networking is commented (or remove line) and add following line</p>

<div>
  <pre><code class='console'>bind-address=YOUR-SERVER-IP</code></pre>
</div>


<p>For example, if your MySQL server IP is <code>65.55.55.2</code> then entire block should be look like as follows:</p>

<div>
  <pre><code class='console'>[mysqld]  
user            = mysql  
pid-file        = /var/run/mysqld/mysqld.pid  
socket          = /var/run/mysqld/mysqld.sock  
port            = 3306  
basedir         = /usr  
datadir         = /var/lib/mysql  
tmpdir          = /tmp  
language        = /usr/share/mysql/English  
bind-address    = 65.55.55.2  
#  skip-networking  
....  
..  
....</code></pre>
</div>


<p>Where,</p>

<ul>
<li><strong>bind-address</strong> : IP address to bind to.</li>
<li><strong>skip-networking</strong> : Don’t listen for TCP/IP connections at all. All interaction with mysqld must be made via Unix sockets. This option is highly recommended for systems where only local requests are allowed. Since you need to allow remote connection this line should be removed from my.cnf or put it in comment state.</li>
</ul>


<p>2.Grant access to remote IP address  <br/>
&ndash; Connect to mysql server:</p>

<div>
  <pre><code class='console'>$ mysql -u root -p mysql</code></pre>
</div>


<ul>
<li>Grant access to a new database<br/>
If you want to add a new database called foo for user bar and remote IP <code>202.54.10.20</code> then you need to type the following commands at mysql> prompt:</li>
</ul>


<div>
  <pre><code class='console'>mysql&gt; CREATE DATABASE foo;  
mysql&gt; GRANT ALL ON foo.* TO bar@&#39;202.54.10.20&#39; IDENTIFIED BY &#39;PASSWORD&#39;;</code></pre>
</div>


<ul>
<li>Grant Access To An Existing Database</li>
</ul>


<div>
  <pre><code class='console'>mysql&gt; update db set Host=&#39;202.54.10.20&#39; where Db=&#39;webdb&#39;;  
mysql&gt; update user set Host=&#39;202.54.10.20&#39; where user=&#39;webadmin&#39;;</code></pre>
</div>


<ul>
<li>Test connection</li>
</ul>


<div>
  <pre><code class='console'>$ mysql -u webadmin –h 65.55.55.2 –p</code></pre>
</div>


<p>Where<br/>
&ndash; u webadmin: webadmin is MySQL username <br/>
&ndash; h IP or hostname: 65.55.55.2 is MySQL server IP address or hostname (FQDN) <br/>
&ndash; p Prompt for password</p>

<p>You can also use the telnet or nc command to connect to port 3306 for testing purpose:</p>

<div>
  <pre><code class='console'>$ echo X | telnet -e X 65.55.55.2 3306</code></pre>
</div>


<p>OR</p>

<div>
  <pre><code class='console'>$ nc -z -w1 65.55.55.2 3306</code></pre>
</div>


<p>Sample outputs:</p>

<div>
  <pre><code class='console'>Connection to 65.55.55.2 3306 port [tcp/mysql] succeeded!</code></pre>
</div>


<h4>MySQL 中文乱码</h4>

<p>MySQL中默认字符集的设置有四级:服务器级，数据库级，表级 。最终是字段级 的字符集设置。注意前三种均为默认设置，并不代码你的字段最终会使用这个字符集设置。所以我们建议要用<code>show create table table ;</code> 或<code>show full fields from tableName;</code> 来检查当前表中字段的字符集设置。</p>

<p><strong>1.查看默认的编码格式:</strong></p>

<div>
  <pre><code class='console'>mysql&gt; show variables like &quot;%char%&quot;;
 
+--------------------------+---------------+  
| Variable_name | Value |  
+--------------------------+---------------+  
| character_set_client | gbk |  
| character_set_connection | gbk |  
| character_set_database | utf8 |  
| character_set_filesystem | binary |  
| character_set_results | gbk |  
| character_set_server | utf8 |  
| character_set_system | utf8 |  
+--------------------------+-------------+</code></pre>
</div>


<p>注：以前2个来确定,可以使用<code>set names utf8</code>,<code>set names gbk</code>设置默认的编码格式;</p>

<div>
  <pre><code class='console'>mysql&gt; set names utf8;   **有时候这一句很关键！**</code></pre>
</div>


<p>执行SET NAMES utf8的效果等同于同时设定如下：</p>

<div>
  <pre><code class='console'>SET character_set_client=&#39;utf8&#39;;  
SET character_set_connection=&#39;utf8&#39;;  
SET character_set_results=&#39;utf8&#39;;</code></pre>
</div>


<p><strong>2.数据库表中字段的字符集设置 :</strong></p>

<p><code>show create table TableName</code> 或 <code>show full columns from tableName</code></p>

<div>
  <pre><code class='console'>mysql&gt; show create table t1;  
+-------+------------------------------------  
| Table | Create Table                       
+-------+------------------------------------  
| t1    | CREATE TABLE `t1` (  
  `id` int(11) NOT NULL,  
  `c1` varchar(30) DEFAULT NULL,  
  PRIMARY KEY (`id`)      
) ENGINE=InnoDB DEFAULT CHARSET=gbk |  
+-------+------------------------------------  
1 row in set (0.00 sec)   
                        
mysql&gt; show full columns from t1;  
+-------+-------------+----------------+------+-----+-  
| Field | Type        | Collation      | Null | Key |   
+-------+-------------+----------------+------+-----+-  
| id    | int(11)     | NULL           | NO   | PRI |   
| c1    | varchar(30) | gbk_chinese_ci | YES  |     |   
+-------+-------------+----------------+------+-----+-  
2 rows in set (0.00 sec)   
mysql&gt;</code></pre>
</div>


<p><strong>3.当前联接系统参数</strong></p>

<div>
  <pre><code class='console'>show variables like &#39;char%&#39;    
&gt;+--------------------------+----------------  
| Variable_name            | Value  
+--------------------------+----------------  
| character_set_client     | gbk  
| character_set_connection | gbk  
| character_set_database   | latin1  
| character_set_filesystem | binary  
| character_set_results    | gbk  
| character_set_server     | latin1  
| character_set_system     | utf8  
| character_sets_dir       | C:/Program File  
+--------------------------+----------------  
8 rows in set (0.00 sec)   
mysql&gt;</code></pre>
</div>


<p><strong>4.中文，请确保 表中该字段的字符集为中文兼容：</strong></p>

<div>
  <pre><code class='console'>big5     | Big5 Traditional Chinese  
gb2312   | GB2312 Simplified Chinese  
gbk      | GBK Simplified Chinese  
utf8     | UTF-8 Unicode</code></pre>
</div>


<p><strong>5.确保联接参数与这个字段字符集一致,你可以用 <code>set name 'charsetname';</code></strong><br/>
比如， <code>set name 'gbk';</code><br/>
 这条命令会同时修改</p>

<div>
  <pre><code class='console'>character_set_client  
character_set_connection  
character_set_results</code></pre>
</div>


<p>(如果你的这架MySQL中都为中文，则你可以在<code>my.ini</code>或<code>my.cnf</code>中加上或修改这个参数, 参数文件修改后需重启MySQL服务)</p>

<div>
  <pre><code class='console'>[mysql]
default-character-set=gbk</code></pre>
</div>


<p><strong>Update on 2013-9-20</strong><br/>
上面提到的方法都没有解决中文乱码的问题，最终采用在connection URL 中加入编码参数的方法，问题解决，终于可以正常存入和显示中文了。</p>

<div>
  <pre><code class='console'>jdbc:mysql://serverhost:3306/database?useUnicode=true&amp;characterEncoding=utf-8</code></pre>
</div>



</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">zJun</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-17T21:06:19+08:00" pubdate data-updated="true">Sep 17<span>th</span>, 2013</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category label label-primary' href='/blog/categories/others/'>Others</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2013/08/15/git_commands_notes/" title="Previous Post: Git常用命令笔记">&laquo; Git常用命令笔记</a></li>
            
            
            <li class="next"><a href="/blog/2013/09/18/change_mysql_root_password/" title="Next Post: MySQL 修改 root 密码">MySQL 修改 root 密码 &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
    
    <a class="list-group-item " href="/blog/categories/web/index.html">
        <span class="badge">7</span>
        Web
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/java/index.html">
        <span class="badge">19</span>
        Java
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/database/index.html">
        <span class="badge">2</span>
        Database
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/others/index.html">
        <span class="badge">10</span>
        Others
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/web开发/index.html">
        <span class="badge">1</span>
        Web开发
      </a>
    
    
    <a class="list-group-item " href="/blog/categories/golang/index.html">
        <span class="badge">8</span>
        golang
      </a>
    
  </div>
</section><section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2014/02/08/go_note_7_goroutine/">Go笔记7:并发</a>
    
    <a class="list-group-item " href="/blog/2014/01/22/go_note_6_data_structure/">Go笔记6：Go数据结构</a>
    
    <a class="list-group-item " href="/blog/2014/01/16/dev_go_in_sublimetext2/">在Sublime Text2中开发Golang</a>
    
    <a class="list-group-item " href="/blog/2014/01/03/go_note_5_accessmysql/">Go笔记5：访问MySQL数据库</a>
    
    <a class="list-group-item " href="/blog/2013/12/30/go_note_4_interface/">Go笔记4：接口</a>
    
    <a class="list-group-item " href="/blog/2013/12/19/go_note_3_object/">Go笔记3：面向对象</a>
    
    <a class="list-group-item " href="/blog/2013/12/04/spring_mvc_rest/">Spring MVC 实现 REST Service</a>
    
    <a class="list-group-item " href="/blog/2013/12/03/use_spring_data_jpa/">使用Spring Data JPA 简化持久层的开发</a>
    
    <a class="list-group-item " href="/blog/2013/10/27/go_note_2_basic_grammar/">Go笔记2：基础语法</a>
    
    <a class="list-group-item " href="/blog/2013/10/24/go_note_1_install/">Go笔记1：环境配置</a>
    
  </div>
</section>

    
  </aside>
  
</div>


        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - zJun<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'zJun';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://zjun.github.io/blog/2013/09/17/setup_raspberrypi_as_webserver/';
        var disqus_url = 'http://zjun.github.io/blog/2013/09/17/setup_raspberrypi_as_webserver/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











  </body>
</html>
